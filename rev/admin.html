<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω–∫–∞ | –û—Ü–µ–Ω–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π | @gavril_anatolievich</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="apple-mobile-web-app-status-bar-style" content="#ffffff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="–û—Ü–µ–Ω–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π by @gavril_anatolievich" />
    
    <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <link rel="manifest" href="site.webmanifest" />
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fb;
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞ */
        .login-form {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #1a2a6c;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 1rem;
            line-height: 1;
        }
        
        .btn-full {
            width: 100%;
        }
        
        .btn-primary {
            background: #1a2a6c;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0d1a4d;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .error-message {
            color: #dc3545;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
        .admin-panel {
            display: none;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #1a2a6c;
        }
        
        .admin-title {
            font-size: 2rem;
            color: #1a2a6c;
        }
        
        .admin-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logout-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            line-height: 1;
        }
        
        .logout-btn:hover {
            background: #5a6268;
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1a2a6c;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .admin-actions {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn-sm {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .events-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .events-table th, .events-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .events-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #1a2a6c;
        }
        
        .events-table img {
            height: 60px;
            width: auto;
            border-radius: 5px;
            object-fit: cover;
        }

        .events-table tr:hover {
            background: #f8f9fa;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            color: #1a2a6c;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #dc3545;
        }

        .modal-body {
            padding: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .event-form {
            background: white;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .upload-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #1a2a6c;
        }

        .upload-section h4 {
            color: #1a2a6c;
            margin-bottom: 10px;
        }

        .upload-instructions {
            font-size: 0.9rem;
            color: #666;
        }

        .upload-instructions ol {
            padding-left: 20px;
            margin: 10px 0;
        }

        .upload-instructions li {
            margin-bottom: 5px;
        }
        
        .image-preview {
            max-width: 300px;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid #ddd;
            display: none;
        }

        .text-muted {
            color: #6c757d !important;
            font-size: 0.875rem;
        }
        
        .form-check {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .form-check-input {
            margin-right: 10px;
        }
        
        .hidden {
            display: none;
        }
        
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #1a2a6c;
            text-decoration: none;
            font-weight: 600;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            gap: 10px;
        }

        .pagination-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #1a2a6c;
            color: white;
            border-color: #1a2a6c;
        }

        .pagination-btn:disabled {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }

        .pagination-info {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .page-size-selector select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #28a745;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        input:disabled + .slider {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã */
        .events-table td {
            vertical-align: middle;
        }

        .active-checkbox:disabled {
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .admin-actions {
                flex-direction: column;
            }
            
            .admin-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
            }

            .pagination {
                flex-wrap: wrap;
            }

            .page-size-selector {
                margin-left: 0;
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
        <div class="login-form" id="login-form">
            <h2>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <div class="form-group">
                <label for="admin-email">Email</label>
                <input type="email" id="admin-email" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="admin-password">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="admin-password" class="form-control" required>
            </div>
            <button class="btn btn-primary btn-full" id="login-btn">–í–æ–π—Ç–∏</button>
            <div class="error-message" id="login-error">–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å</div>
        </div>
        
        <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
        <div class="admin-panel" id="admin-panel">
            <div class="admin-header">
                <h1 class="admin-title">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
                <div class="admin-user">
                    <span id="user-email"></span>
                    <button class="logout-btn" id="logout-btn">–í—ã–π—Ç–∏</button>
                </div>
            </div>
            
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-label">–í—Å–µ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</div>
                    <div class="stat-value" id="total-events">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</div>
                    <div class="stat-value" id="active-events">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–í—Å–µ–≥–æ –æ—Ü–µ–Ω–æ–∫</div>
                    <div class="stat-value" id="total-ratings">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</div>
                    <div class="stat-value" id="avg-rating">0.0</div>
                </div>
            </div>
            
            <div class="admin-actions">
                <button class="btn btn-primary btn-sm" id="add-event-btn">–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</button>
                <button class="btn btn-success btn-sm" id="export-excel-btn">–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
                <button class="btn btn-info btn-sm" id="refresh-data-btn">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            </div>
            
            <h3>–°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h3>
            
            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            <div class="pagination">
                <button class="pagination-btn" id="first-page-btn" disabled>¬´</button>
                <button class="pagination-btn" id="prev-page-btn" disabled>‚Äπ</button>
                
                <span class="pagination-info" id="page-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>
                
                <button class="pagination-btn" id="next-page-btn" disabled>‚Ä∫</button>
                <button class="pagination-btn" id="last-page-btn" disabled>¬ª</button>
                
                <div class="page-size-selector">
                    <span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ:</span>
                    <select id="page-size-select">
                        <option value="5">5</option>
                        <option value="10" selected>10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                    </select>
                </div>
            </div>
            
            <table class="events-table">
                <thead>
                    <tr>
                        <th>–ê—Ñ–∏—à–∞</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ê–∫—Ç–∏–≤–Ω–æ</th>
                        <th>–û—Ü–µ–Ω–æ–∫</th>
                        <th>–°—Ä. –æ—Ü–µ–Ω–∫–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="events-table-body">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Firebase -->
                </tbody>
            </table>
            
            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –≤–Ω–∏–∑—É -->
            <div class="pagination">
                <button class="pagination-btn" id="first-page-btn-bottom" disabled>¬´</button>
                <button class="pagination-btn" id="prev-page-btn-bottom" disabled>‚Äπ</button>
                
                <span class="pagination-info" id="page-info-bottom">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>
                
                <button class="pagination-btn" id="next-page-btn-bottom" disabled>‚Ä∫</button>
                <button class="pagination-btn" id="last-page-btn-bottom" disabled>¬ª</button>
            </div>
            
            <a href="index.html" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É</a>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
    <div id="event-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h3>
                <button class="close-btn" id="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-section">
                    <h4>–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h4>
                    <div class="upload-instructions">
                        <p><strong>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É:</strong></p>
                        <ol>
                            <li>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ <a href="https://postimages.org/" target="_blank">PostImage</a> –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ö–æ—Å—Ç–∏–Ω–≥</li>
                            <li>–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ <strong>"Direct Link"</strong></li>
                            <li>–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –≤ –ø–æ–ª–µ –Ω–∏–∂–µ</li>
                        </ol>
                        <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                            –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏: <code>https://i.postimg.cc/abc123/image.jpg</code>
                        </p>
                    </div>
                </div>
                
                <form id="event-form-data">
                    <input type="hidden" id="event-id">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="event-name">–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è *</label>
                            <input type="text" id="event-name" class="form-control" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è">
                        </div>
                        <div class="form-group">
                            <label for="event-date">–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è</label>
                            <input type="date" id="event-date" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="event-image">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è *</label>
                        <input type="url" id="event-image" class="form-control" required 
                               placeholder="https://i.postimg.cc/.../image.jpg"
                               pattern="https?://.+\..+">
                        <small class="text-muted">–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å PostImage –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ —Ö–æ—Å—Ç–∏–Ω–≥–∞</small>
                    </div>
                    
                    <div class="form-group">
                        <label>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                        <div id="image-preview-container">
                            <img id="image-preview" class="image-preview" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" 
                                 onerror="this.style.display='none'">
                            <div id="image-status" style="margin-top: 10px;"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" id="save-event-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</button>
                        <button type="button" class="btn btn-danger" id="cancel-event-btn">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA8t1PgSdfQIJv31-13qqc-0_5zRLmelNA",
            authDomain: "ddnrev.firebaseapp.com",
            projectId: "ddnrev",
            storageBucket: "ddnrev.firebasestorage.app",
            messagingSenderId: "779077027465",
            appId: "1:779077027465:web:b61f89152d721ab2176858"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const loginForm = document.getElementById('login-form');
        const adminPanel = document.getElementById('admin-panel');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const adminEmail = document.getElementById('admin-email');
        const adminPassword = document.getElementById('admin-password');
        const loginError = document.getElementById('login-error');
        const userEmail = document.getElementById('user-email');
        const addEventBtn = document.getElementById('add-event-btn');
        const exportExcelBtn = document.getElementById('export-excel-btn');
        const refreshDataBtn = document.getElementById('refresh-data-btn');
        const eventsTableBody = document.getElementById('events-table-body');
        const eventImageInput = document.getElementById('event-image');
        const imagePreview = document.getElementById('image-preview');
        const imageStatus = document.getElementById('image-status');

        // –≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        const eventModal = document.getElementById('event-modal');
        const modalTitle = document.getElementById('modal-title');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const cancelEventBtn = document.getElementById('cancel-event-btn');
        const eventFormData = document.getElementById('event-form-data');

        // –≠–ª–µ–º–µ–Ω—Ç—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        const firstPageBtn = document.getElementById('first-page-btn');
        const prevPageBtn = document.getElementById('prev-page-btn');
        const nextPageBtn = document.getElementById('next-page-btn');
        const lastPageBtn = document.getElementById('last-page-btn');
        const pageInfo = document.getElementById('page-info');
        const pageSizeSelect = document.getElementById('page-size-select');

        const firstPageBtnBottom = document.getElementById('first-page-btn-bottom');
        const prevPageBtnBottom = document.getElementById('prev-page-btn-bottom');
        const nextPageBtnBottom = document.getElementById('next-page-btn-bottom');
        const lastPageBtnBottom = document.getElementById('last-page-btn-bottom');
        const pageInfoBottom = document.getElementById('page-info-bottom');

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let events = [];
        let ratings = [];
        let currentUser = null;

        // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
        let currentPage = 1;
        let pageSize = 10;
        let totalPages = 1;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                userEmail.textContent = user.email;
                loginForm.style.display = 'none';
                adminPanel.classList.add('active');
                loadEventsForAdmin();
            } else {
                currentUser = null;
                loginForm.style.display = 'block';
                adminPanel.classList.remove('active');
            }
        });

        // –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
        loginBtn.addEventListener('click', () => {
            const email = adminEmail.value;
            const password = adminPassword.value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    loginError.style.display = 'none';
                })
                .catch((error) => {
                    loginError.style.display = 'block';
                    console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ", error);
                });
        });

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        logoutBtn.addEventListener('click', () => {
            auth.signOut();
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        refreshDataBtn.addEventListener('click', () => {
            loadEventsForAdmin();
        });

        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        addEventBtn.addEventListener('click', () => {
            openEventModal();
        });

        closeModalBtn.addEventListener('click', () => {
            closeEventModal();
        });

        cancelEventBtn.addEventListener('click', () => {
            closeEventModal();
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.addEventListener('click', (e) => {
            if (e.target === eventModal) {
                closeEventModal();
            }
        });

        function openEventModal(eventId = null) {
            if (eventId) {
                // –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ';
                const event = events.find(e => e.id === eventId);
                if (event) {
                    document.getElementById('event-id').value = event.id;
                    document.getElementById('event-name').value = event.name || '';
                    document.getElementById('event-date').value = event.date || '';
                    document.getElementById('event-image').value = event.image;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é —Ç–µ–∫—É—â–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    imagePreview.src = event.image;
                    imagePreview.style.display = 'block';
                    imageStatus.innerHTML = '<span style="color: #28a745;">‚úÖ –¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</span>';
                }
            } else {
                // –†–µ–∂–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                modalTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ';
                eventFormData.reset();
                document.getElementById('event-id').value = '';
                imagePreview.style.display = 'none';
                imageStatus.innerHTML = '';
            }
            eventModal.style.display = 'block';
        }

        function closeEventModal() {
            eventModal.style.display = 'none';
        }

        // –ê–≤—Ç–æ–ø—Ä–µ–≤—å—é –ø—Ä–∏ –≤–≤–æ–¥–µ —Å—Å—ã–ª–∫–∏
        eventImageInput.addEventListener('input', function() {
            const url = this.value.trim();
            
            if (url) {
                imagePreview.src = url;
                imagePreview.style.display = 'block';
                imageStatus.innerHTML = '<span style="color: #17a2b8;">üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...</span>';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
                imagePreview.onload = function() {
                    imageStatus.innerHTML = '<span style="color: #28a745;">‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ</span>';
                };
                
                imagePreview.onerror = function() {
                    imageStatus.innerHTML = '<span style="color: #dc3545;">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É.</span>';
                    imagePreview.style.display = 'none';
                };
            } else {
                imagePreview.style.display = 'none';
                imageStatus.innerHTML = '';
            }
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
        eventFormData.addEventListener('submit', (e) => {
            e.preventDefault();
            saveEvent();
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –≤ Firebase
        function saveEvent() {
            const eventId = document.getElementById('event-id').value;
            const name = document.getElementById('event-name').value;
            const date = document.getElementById('event-date').value;
            const image = document.getElementById('event-image').value;
            
            if (!name.trim()) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è');
                return;
            }
            
            if (!image.trim()) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Å—ã–ª–∫–∞ –≤–∞–ª–∏–¥–Ω–∞—è
            try {
                new URL(image);
            } catch (e) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É');
                return;
            }
            
            const eventData = {
                name: name.trim(),
                date: date || '',
                image: image.trim(),
                active: true, // –ù–æ–≤—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–∫—Ç–∏–≤–Ω—ã
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            let promise;
            if (eventId) {
                // –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                const currentEvent = events.find(e => e.id === eventId);
                eventData.active = currentEvent ? currentEvent.active : true;
                promise = db.collection('events').doc(eventId).update(eventData);
            } else {
                promise = db.collection('events').add(eventData);
            }
            
            promise
                .then(() => {
                    showNotification('–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!', 'success');
                    loadEventsForAdmin();
                    closeEventModal();
                })
                .catch((error) => {
                    console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ", error);
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è', 'error');
                });
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
        exportExcelBtn.addEventListener('click', () => {
            exportToExcel();
        });

        function exportToExcel() {
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
            const exportData = events.map(event => ({
                '–ù–∞–∑–≤–∞–Ω–∏–µ': event.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
                '–î–∞—Ç–∞': event.date || '',
                '–ê–∫—Ç–∏–≤–Ω–æ': event.active ? '–î–∞' : '–ù–µ—Ç',
                '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫': event.ratingsCount || 0,
                '–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞': event.calculatedAvgRating || 0,
                '–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ': event.image
            }));
            
            // –°–æ–∑–¥–∞–µ–º workbook
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è");
            
            // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º
            XLSX.writeFile(wb, `–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
        function loadEventsForAdmin() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
            db.collection('events').get()
                .then((eventsSnapshot) => {
                    events = [];
                    eventsSnapshot.forEach((doc) => {
                        events.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ü–µ–Ω–∫–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    return db.collection('ratings').get();
                })
                .then((ratingsSnapshot) => {
                    const ratingsByEvent = {};
                    
                    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –æ—Ü–µ–Ω–∫–∏ –ø–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º
                    ratingsSnapshot.forEach((doc) => {
                        const ratingData = doc.data();
                        const eventId = ratingData.eventId;
                        
                        if (!ratingsByEvent[eventId]) {
                            ratingsByEvent[eventId] = [];
                        }
                        ratingsByEvent[eventId].push(ratingData.rating);
                    });
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –æ–±—ä–µ–∫—Ç–∞—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
                    events.forEach(event => {
                        const eventRatings = ratingsByEvent[event.id] || [];
                        event.ratingsCount = eventRatings.length;
                        
                        if (eventRatings.length > 0) {
                            const sum = eventRatings.reduce((a, b) => a + b, 0);
                            event.calculatedAvgRating = parseFloat((sum / eventRatings.length).toFixed(1));
                        } else {
                            event.calculatedAvgRating = 0;
                        }
                    });
                    
                    updatePagination();
                    renderEventsTable();
                    updateAdminStats();
                })
                .catch((error) => {
                    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ", error);
                });
        }

        // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
        function updatePagination() {
            totalPages = Math.ceil(events.length / pageSize);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            pageInfo.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages}`;
            pageInfoBottom.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            firstPageBtn.disabled = currentPage === 1;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            lastPageBtn.disabled = currentPage === totalPages;
            
            firstPageBtnBottom.disabled = currentPage === 1;
            prevPageBtnBottom.disabled = currentPage === 1;
            nextPageBtnBottom.disabled = currentPage === totalPages;
            lastPageBtnBottom.disabled = currentPage === totalPages;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        firstPageBtn.addEventListener('click', () => goToPage(1));
        prevPageBtn.addEventListener('click', () => goToPage(currentPage - 1));
        nextPageBtn.addEventListener('click', () => goToPage(currentPage + 1));
        lastPageBtn.addEventListener('click', () => goToPage(totalPages));

        firstPageBtnBottom.addEventListener('click', () => goToPage(1));
        prevPageBtnBottom.addEventListener('click', () => goToPage(currentPage - 1));
        nextPageBtnBottom.addEventListener('click', () => goToPage(currentPage + 1));
        lastPageBtnBottom.addEventListener('click', () => goToPage(totalPages));

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        pageSizeSelect.addEventListener('change', (e) => {
            pageSize = parseInt(e.target.value);
            currentPage = 1;
            updatePagination();
            renderEventsTable();
        });

        function goToPage(page) {
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                updatePagination();
                renderEventsTable();
            }
        }

        function getCurrentPageEvents() {
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            return events.slice(startIndex, endIndex);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
        window.toggleEventActive = function(eventId, checkbox) {
            const isActive = checkbox.checked;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const originalState = checkbox.checked;
            checkbox.disabled = true;
            
            db.collection('events').doc(eventId).update({
                active: isActive,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –º–∞—Å—Å–∏–≤–µ
                const event = events.find(e => e.id === eventId);
                if (event) {
                    event.active = isActive;
                }
                updateAdminStats();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification(`–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ ${isActive ? '–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ' : '–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ'}`, 'success');
            })
            .catch((error) => {
                console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ", error);
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —á–µ–∫–±–æ–∫—Å –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                checkbox.checked = !originalState;
                showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'error');
            })
            .finally(() => {
                checkbox.disabled = false;
            });
        };

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 5px;
                color: white;
                font-weight: 600;
                z-index: 1000;
                animation: slideIn 0.3s ease;
                ${type === 'success' ? 'background: #28a745;' : ''}
                ${type === 'error' ? 'background: #dc3545;' : ''}
                ${type === 'info' ? 'background: #17a2b8;' : ''}
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function renderEventsTable() {
            eventsTableBody.innerHTML = '';
            
            const currentPageEvents = getCurrentPageEvents();
            
            if (currentPageEvents.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">–ù–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td>`;
                eventsTableBody.appendChild(row);
                return;
            }
            
            currentPageEvents.forEach(event => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>
                        <img src="${event.image}" alt="${event.name}" 
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIGZpbGw9IiNmMWYxZjEiLz48dGV4dCB4PSIzMCIgeT0iMzUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+0J7RiNC40LHQutCwPC90ZXh0Pjwvc3ZnPg=='">
                    </td>
                    <td>${event.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</td>
                    <td>${event.date || ''}</td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" 
                                   ${event.active ? 'checked' : ''}
                                   onchange="toggleEventActive('${event.id}', this)"
                                   class="active-checkbox">
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td>${event.ratingsCount || 0}</td>
                    <td>${event.calculatedAvgRating || 0}</td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="editEvent('${event.id}')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteEvent('${event.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                `;
                
                eventsTableBody.appendChild(row);
            });
        }

        function updateAdminStats() {
            document.getElementById('total-events').textContent = events.length;
            document.getElementById('active-events').textContent = events.filter(e => e.active).length;
            
            const totalRatings = events.reduce((sum, event) => sum + (event.ratingsCount || 0), 0);
            document.getElementById('total-ratings').textContent = totalRatings;
            
            if (totalRatings > 0) {
                let totalScore = 0;
                events.forEach(event => {
                    const eventRatings = event.ratingsCount || 0;
                    const eventAvg = event.calculatedAvgRating || 0;
                    totalScore += eventAvg * eventRatings;
                });
                const avgRating = (totalScore / totalRatings).toFixed(1);
                document.getElementById('avg-rating').textContent = avgRating;
            } else {
                document.getElementById('avg-rating').textContent = '0.0';
            }
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
        window.editEvent = function(eventId) {
            openEventModal(eventId);
        };

        // –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
        window.deleteEvent = function(eventId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ? –í—Å–µ –æ—Ü–µ–Ω–∫–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –∫–ª–∏–∫–Ω—É–ª–∏
                const buttons = document.querySelectorAll(`button[onclick="deleteEvent('${eventId}')"]`);
                if (buttons.length > 0) {
                    const deleteBtn = buttons[0];
                    const originalText = deleteBtn.textContent;
                    deleteBtn.textContent = '–£–¥–∞–ª–µ–Ω–∏–µ...';
                    deleteBtn.disabled = true;
                    
                    // –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º –≤—Å–µ –æ—Ü–µ–Ω–∫–∏ —ç—Ç–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
                    db.collection('ratings')
                        .where('eventId', '==', eventId)
                        .get()
                        .then((querySnapshot) => {
                            const deletePromises = [];
                            querySnapshot.forEach((doc) => {
                                deletePromises.push(doc.ref.delete());
                            });
                            
                            if (deletePromises.length > 0) {
                                return Promise.all(deletePromises);
                            }
                            return Promise.resolve();
                        })
                        .then(() => {
                            // –ó–∞—Ç–µ–º —É–¥–∞–ª—è–µ–º —Å–∞–º–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                            return db.collection('events').doc(eventId).delete();
                        })
                        .then(() => {
                            showNotification('–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –∏ –≤—Å–µ –æ—Ü–µ–Ω–∫–∏ —É–¥–∞–ª–µ–Ω—ã!', 'success');
                            loadEventsForAdmin();
                        })
                        .catch((error) => {
                            console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ", error);
                            showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: ' + error.message, 'error');
                        })
                        .finally(() => {
                            deleteBtn.textContent = originalText;
                            deleteBtn.disabled = false;
                        });
                }
            }
        };
    </script>
</body>
</html>