<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор технического райдера by GansEast</title>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/inputmask@5/dist/inputmask.min.js"></script>
    <!-- <script src="index.js"></script> -->
    <style>
        * {
            -webkit-box-sizing: border-box;
               -moz-box-sizing: border-box;
                    box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #fff;
            background: url(ddn.webp) no-repeat center center fixed;
            background-size: cover;
        }
        .container {
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 25px 30px;
            background: #fff;
        }
        .container-title {
          text-align: center;
          margin-bottom: 20px;
        }
        .container-title h2,
        .container-title p {
          margin: 0;
        }
        .container-title img {
          margin: 0 auto;
          width: 64px;
        }
        .container-datetime { display: flex; gap: 20px; }
        .container-datetime-item { flex: 1; }
        label {
          font-size: 12px;
          font-style: italic;
        }
        input, select, button, textarea {
          display: block;
          width: 100%;
          margin-top: 4px;
          margin-bottom: 12px;
          padding: 10px;
          font-size: 16px;
          border: 1px solid #ccc;
          border-radius: 9px;
        }
        select {
          appearance: none;
          -webkit-appearance: none;
          -moz-appearance: none;
          background: url("data:image/svg+xml;utf8,<svg fill='121212' height='16' viewBox='0 0 24 24' width='16' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>") no-repeat right 10px center;
          background-color: #fff;
          background-size: 24px;
          padding: 10px 40px 10px 10px; /* место для стрелки */
        }
        input[type="date"] {
          padding: 10px 12px 10px 10px;
        }
        input[type="date"],
        input[type="time"] {
          width: 100%;
          height: 40px;
          color: #999;
        }
        input::placeholder,
        select::placeholder,
        textarea::placeholder,
        input[type="date"],
        input[type="time"] {
          font-family: Arial, sans-serif;
        }
        input:focus,
        select:focus,
        textarea:focus {
            border-color: #007bff60 !important;
            background-color: #007bff15 !important;
            outline: none;
        }
        input:invalid,
        select:invalid,
        textarea:invalid {
            border-color: #ff000060;
            background-color: #ff000015;
        }

        input:valid,
        select:valid,
        textarea:valid {
            border-color: #007bff60;
            background-color: #007bff15;
        }
        textarea {
          resize: none;
          min-height: 40px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .error {
            border-color: red;
        }
        @media (min-width: 601px) {
          .container {
            max-width: 600px;
            padding: 25px 50px;
            margin: 30px auto;
          }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="container-title">
      <img src="1.webp" alt="">
      <h2>Генератор технического райдера</h2>
      <p>
        Дома дружбы народов им. А.Е. Кулаковского
      </p>

    </div>
    <label>
      Мероприятие:
      <input type="text" id="event" placeholder="Название мероприятия" required>
    </label>
    <div class="container-datetime">
      <div class="container-datetime-item">
        <label>
          Дата:
          <input type="date" id="date" required>
        </label>
      </div>
      <div class="container-datetime-item">
        <label>
          Время:
          <input type="time" id="time" step="1800" required>
        </label>
        <label>
          Репетиция:
          <input type="time" id="rehearsal" step="1800" placeholder="Репетиция" required>
        </label>
      </div>
    </div>
    <label>
      Заказчик:
      <input type="text" id="name" placeholder="Наименование организации" required>
    </label>
    <label>
      Телефон:
      <input type="tel" id="phone" placeholder="+7 (___) ___-__-__" required maxlength="18">
    </label>
    <label>
      Зал:
      <select id="hall" required>
          <option value="" disabled selected>-- Выберите зал --</option>
          <option value="Большой зал">Большой зал</option>
          <option value="Мраморный зал">Мраморный зал</option>
          <option value="Гостиная">Гостиная</option>
      </select>
    </label>
    <label>
      Звуковое техническое обеспечение:
      <textarea id="sound" required placeholder="Примечание:  Аудио материалы предоставляются за 2 часа до начала мероприятия"></textarea>
    </label>
    <label>
      Световое техническое обеспечение:
      <textarea id="light" required placeholder="Световое техническое обеспечение"></textarea>
    </label>
    <label>
      Видео оформление мероприятия:
      <textarea id="video" required placeholder="Примечание:  Видео материалы предоставляются за 2 часа до начала мероприятия"></textarea>
    </label>
    <label>
      Постановочная часть (сценография):
      <textarea id="scene" required placeholder="Постановочная часть (сценография)"></textarea>
    </label>
    <label>
      Дополнительное техническое оборудование:
      <textarea id="tech" placeholder="Дополнительное техническое оборудование"></textarea>
    </label>
    <label>
      Примечание:
      <input type="note" id="note">
    </label>
    <button onclick="generateDocx()">Скачать</button>
</div>

<script>
// Маски для телефона и времени
Inputmask({ mask: "+7 (999) 999-99-99", showMaskOnHover: false }).mask("#phone");
Inputmask({ alias: "datetime", inputFormat: "HH:MM", hourFormat: "24" }).mask("#time");
Inputmask({ alias: "datetime", inputFormat: "HH:MM", hourFormat: "24" }).mask("#rehearsal");

function generateDocx() {
  const { Document, Packer, Paragraph, TextRun } = docx;

  const event = document.getElementById('event').value.trim();
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;
  const rehearsal = document.getElementById('rehearsal').value;
  const hall = document.getElementById('hall').value;
  const sound = document.getElementById('sound').value.trim();
  const light = document.getElementById('light').value.trim();
  const video = document.getElementById('video').value.trim();
  const scene = document.getElementById('scene').value.trim();
  const tech = document.getElementById('tech').value.trim() || "-";
  const note = document.getElementById('note').value.trim() || "-";

  if (!event || !name || !phone || !date || !time || !rehearsal || !hall || !sound || !light || !video || !scene) {
    alert("Пожалуйста, заполните все обязательные поля!");
    return;
  }

  // Проверка даты
  const selectedDate = dayjs(date);
  const today = dayjs().startOf('day');
  if (selectedDate.isAfter(today)) {
    alert("Дата мероприятия не может быть позже сегодняшнего дня!");
    return;
  }

  // Проверка времени
  const eventTime = dayjs(`${date}T${time}`);
  const rehearsalTime = dayjs(`${date}T${rehearsal}`);
  if (!rehearsalTime.isBefore(eventTime)) {
    alert("Репетиция должна быть раньше времени начала мероприятия!");
    return;
  }

  const now = dayjs();
  const fileDate = now.format('YYYYMMDD');

  const doc = new Document({
    sections: [{
      properties: { page: { margin: { top: 720, right: 720, bottom: 720, left: 720 } } },
      children: [
        new Paragraph({ children: [new TextRun({ text: "ТЕХНИЧЕСКИЙ РАЙДЕР", bold: true, size: 32 })], alignment: "center" }),
        new Paragraph({ children: [new TextRun("")] }),
        new Paragraph({ children: [new TextRun({ text: `Название: ${event}`, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: `Дата: ${date}  Время: ${time}`, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: `Репетиция: ${rehearsal}`, size: 28 })] }),
        new Paragraph({ children: [new TextRun("")] }),
        new Paragraph({ children: [new TextRun({ text: `Заказчик: ${name}`, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: `Телефон: ${phone}`, size: 28 })] }),
        new Paragraph({ children: [new TextRun("")] }),
        new Paragraph({ children: [new TextRun({ text: `Зал: ${hall}`, size: 28 })] }),
        new Paragraph({ children: [new TextRun("")] }),
        new Paragraph({ children: [new TextRun({ text: "Звуковое техническое обеспечение", bold: true, underline: {}, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: sound, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: "Световое техническое обеспечение", bold: true, underline: {}, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: light, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: "Видео оформление мероприятия", bold: true, underline: {}, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: video, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: "Постановочная часть (сценография)", bold: true, underline: {}, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: scene, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: "Дополнительное техническое оборудование", bold: true, underline: {}, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: tech, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: "Примечание", bold: true, underline: {}, size: 28 })] }),
        new Paragraph({ children: [new TextRun({ text: note, size: 28 })] }),
      ]
    }]
  });

  Packer.toBlob(doc).then(blob => {
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `${fileDate}_${event.replace(/\s+/g, "_")}.docx`;
    link.click();
    URL.revokeObjectURL(link.href);
  });
}
</script>

</body>
</html>
