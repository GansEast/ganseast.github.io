<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор технического райдера by GansEast</title>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!-- <script src="index.js"></script> -->
    <style>
        * {
            -webkit-box-sizing: border-box;
               -moz-box-sizing: border-box;
                    box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #fff;
            background: url(ddn.webp);
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
        }
        .container {
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 25px 30px;
            background: #fff;
        }
        .container-title {
          text-align: center;
          margin-bottom: 20px;
        }
        .container-title h2,
        .container-title p {
          margin: 0;
        }
        .container-title img {
          margin: 0 auto;
          width: 64px;
        }
        .container-datetime {
          display: flex;
        }
        .container-datetime-item {
          width: 50%;
        }
        .container-datetime-item:first-child {
          margin-right: 40px;
        }
        label {
          font-size: 12px;
          font-style: italic;
        }
        input, select, button, textarea {
          display: block;
          width: 100%;
          margin-bottom: 10px;
          padding: 10px;
          font-size: 16px;
          border: 1px solid #ccc;
          border-radius: 9px;
        }
        select {
          appearance: none;
          -webkit-appearance: none;
          -moz-appearance: none;
          background: url("data:image/svg+xml;utf8,<svg fill='121212' height='16' viewBox='0 0 24 24' width='16' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>") no-repeat right 10px center;
          background-color: #fff;
          background-size: 24px;
          padding: 10px 40px 10px 10px; /* место для стрелки */
        }
        input[type="date"] {
          padding: 10px 12px 10px 10px;
        }
        input[type="date"],
        input[type="time"] {
          width: 100%;
          height: 40px;
          color: #999;
        }
        input::placeholder,
        select::placeholder,
        textarea::placeholder,
        input[type="date"],
        input[type="time"] {
          font-family: Arial, sans-serif;
        }
        input:focus,
        select:focus,
        textarea:focus {
            border-color: #007bff60 !important;
            background-color: #007bff15 !important;
            outline: none;
        }
        input:invalid,
        select:invalid,
        textarea:invalid {
            border-color: #ff000060;
            background-color: #ff000015;
        }

        input:valid,
        select:valid,
        textarea:valid {
            border-color: #007bff60;
            background-color: #007bff15;
        }
        textarea {
          resize: none;
          min-height: 40px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .error {
            border-color: red;
        }
        @media (min-width: 601px) {
          .container {
            max-width: 600px;
            padding: 25px 50px;
            margin: 30px auto;
          }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="container-title">
      <img src="1.webp" alt="">
      <h2>Генератор технического райдера</h2>
      <p>
        Дома дружбы народов им. А.Е. Кулаковского
      </p>

    </div>
    <label>
      Мероприятие:
      <input type="text" id="event" placeholder="Название мероприятия" required>
    </label>
    <div class="container-datetime">
      <div class="container-datetime-item">
        <label>
          Дата:
          <input type="date" id="date" placeholder="Дата" required>
        </label>
      </div>
      <div class="container-datetime-item">
        <label>
          Время:
          <input type="time" id="time" placeholder="Время" required>
        </label>
        <label>
          Репетиция:
          <input type="time" id="rehearsal" placeholder="Репетиция" required>
        </label>
      </div>
    </div>
    <label>
      Заказчик:
      <input type="text" id="customer" placeholder="Наименование организации" required>
    </label>
    <label>
      ФИО ответственного лица:
      <input type="text" id="name" placeholder="ФИО" required>
    </label>
    <label>
      Телефон:
      <input type="tel" id="phone" placeholder="+7 (___) ___-__-__" required maxlength="18">
    </label>
    <label>
      Зал:
      <select id="hall" required>
          <option value="" disabled selected>-- Выберите зал --</option>
          <option value="Большой зал">Большой зал</option>
          <option value="Мраморный зал">Мраморный зал</option>
          <option value="Гостиная">Гостиная</option>
          <option value="Конференц-зал">Конференц-зал</option>
          <option value="Выставка">Выставка</option>
      </select>
    </label>
    <div id="bigHallOptions" style="display: none;">
      <label>
        Звуковое техническое обеспечение:
        <textarea id="sound" placeholder="Примечание:  Аудио материалы предоставляются за 2 часа до начала мероприятия"></textarea>
      </label>
      <label>
        Световое техническое обеспечение:
        <textarea id="light" placeholder="Световое техническое обеспечение"></textarea>
      </label>
      <label>
        Видео оформление мероприятия:
        <textarea id="video" placeholder="Примечание:  Видео материалы предоставляются за 2 часа до начала мероприятия"></textarea>
      </label>
      <label>
        Постановочная часть (сценография):
        <textarea id="scene" placeholder="Постановочная часть (сценография)"></textarea>
      </label>
      <label>
        Дополнительное техническое оборудование:
        <textarea id="tech" placeholder="Дополнительное техническое оборудование"></textarea>
      </label>
    </div>
    <label>
      Примечание:
      <input type="note" id="note">
    </label>
    <button onclick="generateDocx()">Скачать</button>
</div>

<script>
// Инициализация flatpickr для даты и времени
flatpickr("#date", {
    altInput: true,
    altFormat: "d.m.Y",
    dateFormat: "Y-m-d",
    minDate: "today" // Нельзя выбрать прошедшие даты
});

flatpickr("#time", {
    enableTime: true,
    noCalendar: true,
    dateFormat: "H:i",
    time_24hr: true
});

flatpickr("#rehearsal", {
    enableTime: true,
    noCalendar: true,
    dateFormat: "H:i",
    time_24hr: true
});

const hallSelect = document.getElementById('hall');
const bigHallOptions = document.getElementById('bigHallOptions');

hallSelect.addEventListener('change', function() {
  if (this.value === 'Большой зал') {
    bigHallOptions.style.display = 'block';
    document.getElementById('sound').required = true;
    document.getElementById('light').required = true;
    document.getElementById('video').required = true;
    document.getElementById('scene').required = true;
    document.getElementById('tech').required = true;
  } else {
    bigHallOptions.style.display = 'none';
    // Сбросить введённые значения
    bigHallOptions.querySelectorAll('input').forEach(input => input.value = '');
  }
});

// Генерация документа
function generateDocx() {
    const eventTime = document.getElementById('time').value;
    const rehearsalTime = document.getElementById('rehearsal').value;
    const eventDate = document.getElementById('date').value;

    if (!eventDate || !eventTime || !rehearsalTime) {
        alert("Заполните дату и время мероприятия и репетиции.");
        return;
    }

    const [eventHour, eventMinute] = eventTime.split(":").map(Number);
    const [rehearsalHour, rehearsalMinute] = rehearsalTime.split(":").map(Number);

    const eventTotalMinutes = eventHour * 60 + eventMinute;
    const rehearsalTotalMinutes = rehearsalHour * 60 + rehearsalMinute;

    if (rehearsalTotalMinutes >= eventTotalMinutes) {
        alert("Время репетиции должно быть раньше начала мероприятия!");
        return;
    }

    const fields = ["event", "name", "phone", "date", "time", "rehearsal", "hall", "customer"];
    let isValid = true;

    fields.forEach(id => {
        const el = document.getElementById(id);
        if (!el.value.trim()) {
            el.classList.add('error');
            isValid = false;
        } else {
            el.classList.remove('error');
        }
    });

    if (!isValid) {
        alert("Заполните все обязательные поля!");
        return;
    }

    const event = document.getElementById('event').value;
    const customer = document.getElementById('customer').value;
    const name = document.getElementById('name').value;
    const phone = document.getElementById('phone').value;
    const date = document.getElementById('date').value;
    const time = document.getElementById('time').value;
    const rehearsal = document.getElementById('rehearsal').value;
    const hall = document.getElementById('hall').value;
    const sound = document.getElementById('sound').value;
    const light = document.getElementById('light').value;
    const video = document.getElementById('video').value;
    const scene = document.getElementById('scene').value;
    const tech = document.getElementById('tech').value;
    const note = document.getElementById('note').value

    // Документ

    const doc = new docx.Document({
        sections: [{
            properties: {
                page: {
                    margin: { top: 720, right: 720, bottom: 720, left: 720 }
                }
            },
            children: [
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: " ТЕХНИЧЕСКИЙ РАЙДЕР", bold: true, size: 32 })],
                    alignment: "center"
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: " " })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `Название: ${event}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: " " })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `Дата: ${date}           Время: ${time}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text:                                         `Репетиция: ${rehearsal}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: " " })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `Заказчик: ${customer}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `ФИО отв. лица: ${name}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `Телефон: ${phone}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: " " })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `Зал: ${hall}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: " " })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: "Звуковое техническое обеспечение", bold: true, underline: {}, size: 32  })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `${sound}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: "Световое техническое обеспечение", bold: true, underline: {}, size: 32  })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `${light}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: "Видео оформление мероприятия", bold: true, underline: {}, size: 32  })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `${video}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: "Постановочная часть (сценография)", bold: true, underline: {}, size: 32  })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `${scene}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: "Дополнительное техническое оборудование", bold: true, underline: {}, size: 32  })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `${tech}`, size: 32 })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: "Примечание", bold: true, underline: {}, size: 32  })]
                }),
                new docx.Paragraph({
                    children: [new docx.TextRun({ text: `${note}`, size: 32 })]
                }),
            ]
        }]
    });

    // Сохраняем документ
    docx.Packer.toBlob(doc).then(blob => {
        saveAs(blob, `Райдер_${date}_${event}.docx`);
    });
}

// Маска для телефона
document.getElementById('phone').addEventListener('input', function(e) {
    let x = e.target.value.replace(/\D/g, '').slice(1);
    let formatted = '+7 ';
    if (x.length > 0) formatted += '(' + x.slice(0,3);
    if (x.length >= 4) formatted += ') ' + x.slice(3,6);
    if (x.length >= 7) formatted += '-' + x.slice(6,8);
    if (x.length >= 9) formatted += '-' + x.slice(8,10);
    e.target.value = formatted;
});
</script>

</body>
</html>
